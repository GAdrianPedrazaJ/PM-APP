{"version":3,"file":"graphql.cjs","sources":["../../src/graphql/client.ts"],"sourcesContent":["/**\n * GraphQL client for the Nhost JavaScript SDK.\n *\n * This module provides functionality for executing GraphQL operations against\n * a Hasura GraphQL API.\n */\n\nimport type { TypedDocumentNode } from '@graphql-typed-document-node/core';\nimport {\n  type ChainFunction,\n  createEnhancedFetch,\n  FetchError,\n  type FetchResponse,\n} from '../fetch';\n\n/**\n * Variables object for GraphQL operations.\n * Key-value pairs of variable names and their values.\n */\nexport type GraphQLVariables = Record<string, unknown>;\n\n/**\n * GraphQL request object used for queries and mutations.\n */\nexport interface GraphQLRequest<TVariables = GraphQLVariables> {\n  /** The GraphQL query or mutation string */\n  query: string;\n  /** Optional variables for parameterized queries */\n  variables?: TVariables;\n  /** Optional name of the operation to execute */\n  operationName?: string;\n}\n\n/**\n * Represents a GraphQL error returned from the server.\n */\nexport interface GraphQLError {\n  /** Error message */\n  message: string;\n  /** Source locations in the GraphQL document where the error occurred */\n  locations?: { line: number; column: number }[];\n  /** Path in the query where the error occurred */\n  path?: string[];\n  /** Additional error information specific to the GraphQL implementation */\n  extensions?: { path: string; code: string };\n}\n\n/**\n * Standard GraphQL response format as defined by the GraphQL specification.\n */\nexport interface GraphQLResponse<TResponseData = unknown> {\n  /** The data returned from successful execution */\n  data?: TResponseData;\n  /** Array of errors if execution was unsuccessful or partially successful */\n  errors?: GraphQLError[];\n}\n\n/**\n * GraphQL client interface providing methods for executing queries and mutations\n */\nexport interface Client {\n  /**\n   * Execute a GraphQL query operation\n   *\n   * Queries are used to fetch data and should not modify any data on the server.\n   *\n   * @param request - GraphQL request object containing query and optional variables\n   * @param options - Additional fetch options to apply to the request\n   * @returns Promise with the GraphQL response and metadata\n   */\n  request<TResponseData = unknown, TVariables = GraphQLVariables>(\n    request: GraphQLRequest<TVariables>,\n    options?: RequestInit,\n  ): Promise<FetchResponse<GraphQLResponse<TResponseData>>>;\n\n  /**\n   * Execute a GraphQL query operation using a typed document node\n   *\n   * @param document - TypedDocumentNode containing the query and type information\n   * @param variables - Variables for the GraphQL operation\n   * @param options - Additional fetch options to apply to the request\n   * @returns Promise with the GraphQL response and metadata\n   */\n  request<TResponseData, TVariables = GraphQLVariables>(\n    document: TypedDocumentNode<TResponseData, TVariables>,\n    variables?: TVariables,\n    options?: RequestInit,\n  ): Promise<FetchResponse<GraphQLResponse<TResponseData>>>;\n\n  /**\n   * URL for the GraphQL endpoint.\n   */\n  url: string;\n\n  /** Add a middleware function to the fetch chain\n   * @param chainFunction - The middleware function to add\n   */\n  pushChainFunction(chainFunction: ChainFunction): void;\n}\n\n/**\n * Creates a GraphQL API client for interacting with a GraphQL endpoint.\n *\n * This client provides methods for executing queries and mutations against\n * a GraphQL API, with support for middleware functions to handle authentication,\n * error handling, and other cross-cutting concerns.\n *\n * @param url - Base URL for the GraphQL endpoint\n * @param chainFunctions - Array of middleware functions for the fetch chain\n * @returns GraphQL client with query and mutation methods\n */\nexport const createAPIClient = (\n  url: string,\n  chainFunctions: ChainFunction[] = [],\n): Client => {\n  let enhancedFetch = createEnhancedFetch(chainFunctions);\n\n  const pushChainFunction = (chainFunction: ChainFunction) => {\n    chainFunctions.push(chainFunction);\n    enhancedFetch = createEnhancedFetch(chainFunctions);\n  };\n\n  const executeOperation = async <\n    TResponseData = unknown,\n    TVariables = GraphQLVariables,\n  >(\n    request: GraphQLRequest<TVariables>,\n    options?: RequestInit,\n  ): Promise<FetchResponse<GraphQLResponse<TResponseData>>> => {\n    const response = await enhancedFetch(`${url}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(request),\n      ...options,\n    });\n\n    const body = await response.text();\n    const data: GraphQLResponse<TResponseData> = (\n      body ? JSON.parse(body) : {}\n    ) as GraphQLResponse<TResponseData>;\n\n    const resp = {\n      body: data,\n      status: response.status,\n      headers: response.headers,\n    };\n\n    if (data.errors) {\n      throw new FetchError(data, response.status, response.headers);\n    }\n\n    return resp;\n  };\n\n  function request<TResponseData = unknown, TVariables = GraphQLVariables>(\n    request: GraphQLRequest<TVariables>,\n    options?: RequestInit,\n  ): Promise<FetchResponse<GraphQLResponse<TResponseData>>>;\n  function request<TResponseData, TVariables = GraphQLVariables>(\n    document: TypedDocumentNode<TResponseData, TVariables>,\n    variables?: TVariables,\n    options?: RequestInit,\n  ): Promise<FetchResponse<GraphQLResponse<TResponseData>>>;\n  function request<TResponseData, TVariables = GraphQLVariables>(\n    requestOrDocument:\n      | GraphQLRequest<TVariables>\n      | TypedDocumentNode<TResponseData, TVariables>,\n    variablesOrOptions?: TVariables | RequestInit,\n    options?: RequestInit,\n  ): Promise<FetchResponse<GraphQLResponse<TResponseData>>> {\n    if (typeof requestOrDocument === 'object' && 'kind' in requestOrDocument) {\n      const definition = requestOrDocument.definitions[0];\n\n      const request: GraphQLRequest<TVariables> = {\n        query: requestOrDocument.loc?.source.body || '',\n        variables: variablesOrOptions as TVariables,\n        operationName:\n          definition && 'name' in definition\n            ? definition.name?.value\n            : undefined,\n      };\n      return executeOperation(request, options);\n    } else {\n      // Handle GraphQLRequest\n      const request = requestOrDocument;\n      const requestOptions = variablesOrOptions as RequestInit;\n      return executeOperation(request, requestOptions);\n    }\n  }\n\n  return {\n    request,\n    url,\n    pushChainFunction,\n  } as Client;\n};\n"],"names":["url","chainFunctions","enhancedFetch","createEnhancedFetch","executeOperation","async","request","options","response","method","headers","body","JSON","stringify","text","data","parse","resp","status","errors","FetchError","requestOrDocument","variablesOrOptions","definition","definitions","query","loc","source","variables","operationName","name","value","pushChainFunction","chainFunction","push"],"mappings":"iJA+G+B,CAC7BA,EACAC,EAAkC,MAElC,IAAIC,EAAgBC,EAAAA,oBAAoBF,GAExC,MAKMG,EAAmBC,MAIvBC,EACAC,KAEA,MAAMC,QAAiBN,EAAc,GAAGF,IAAO,CAC7CS,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAUP,MAClBC,IAGCI,QAAaH,EAASM,OACtBC,EACJJ,EAAOC,KAAKI,MAAML,GAAQ,CAAA,EAGtBM,EAAO,CACXN,KAAMI,EACNG,OAAQV,EAASU,OACjBR,QAASF,EAASE,SAGpB,GAAIK,EAAKI,OACP,MAAM,IAAIC,EAAAA,WAAWL,EAAMP,EAASU,OAAQV,EAASE,SAGvD,OAAOO,CAAA,EAuCT,MAAO,CACLX,QA5BF,SACEe,EAGAC,EACAf,GAEA,GAAiC,iBAAtBc,GAAkC,SAAUA,EAAmB,CACxE,MAAME,EAAaF,EAAkBG,YAAY,GAE3ClB,EAAsC,CAC1CmB,MAAOJ,EAAkBK,KAAKC,OAAOhB,MAAQ,GAC7CiB,UAAWN,EACXO,cACEN,GAAc,SAAUA,EACpBA,EAAWO,MAAMC,WACjB,GAER,OAAO3B,EAAiBE,EAASC,EACnC,CAIE,OAAOH,EAFSiB,EACOC,EAG3B,EAIEtB,MACAgC,kBA9EyBC,IACzBhC,EAAeiC,KAAKD,GACpB/B,EAAgBC,EAAAA,oBAAoBF,EAAc,EA4ElD"}